var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},SingleSignIn;(function(n){"use strict";function l(n,i,r){var u=sj_ce("iframe");u.style.display="none";u.src=decodeURIComponent(n);u.id=o;u.setAttribute("sandbox",r);i>0&&(u.onload=function(){var n=setTimeout(function(){sj_evt.fire("aad:signedout")},i);sj_evt.bind("aad:signedin",function(){return clearTimeout(n)},!0,null,!0);sj_evt.bind("aad:signedout",function(){return clearTimeout(n)},!0,null,!0)});_d.body.appendChild(u)}function a(n){var i=sj_ce("iframe"),r,u,f;i.src="javascript:void(0)";i.title="";i.role="presentation";i.style.display="none";_d.body.appendChild(i);try{r=i.contentWindow.document}catch(e){u=document.domain;i.src="javascript:var d=document.open();d.domain='".concat(u,"';void(0);");r=i.contentWindow.document}f=function(){var t=r.createElement("iframe");t.id="ssofrinjection";r.body.appendChild(t);t.src=decodeURIComponent(n)};r.body||(r.open(),r.write("<body>"),r.close());setTimeout(function(){f()},0)}function f(i,r){if(i!=null){var u=function(){return r?a(i.url):l(i.url,i.failDelay,i.sandbox)},f=_ge(o);f==null?n.isScheduled||(i.triggerEventName?sj_evt.bind(i.triggerEventName,u,1,null,!0):u(),n.isScheduled=!0):(f.parentNode.removeChild(f),u())}}function v(n,r){if(n!=null){var s=!1,l=!1,y=function(r){caches.open(h).then(function(f){return f.put(c,new Response(r)).then(function(){i("CacheRefreshResponse",n.usefdlsLog,"Success","".concat(!0));u()})["catch"](function(){i("CacheRefreshResponse",n.usefdlsLog,"Success","".concat(!1),"Reason","SaveFailure");u()})})["catch"](function(){i("CacheRefreshResponse",n.usefdlsLog,"Success","".concat(!1),"Reason","OpenFailure");u()})},o=function(n,i,r){if(!l){var u=r?"SW":"Client";l=!0;p(n,i,r)}},p=function(e,o,s){var c=!1,h;if(e===200)try{if(h=s?o:JSON.parse(o),h!=null&&h.isAuthenticated){if(n.enableSWTokenRefresh&&!s&&y(o),h.substrateToken&&window.localStorage.setItem("MSBLS_bfbSubstrateToken",h.substrateToken),h.postUserNameInMessage){var l=h.displayName,a=h.uniqueName,v=h.userObjectId,p={displayName:l,uniqueName:a,userObjectId:v};sj_evt.fire("aad:signedin",p)}else sj_evt.fire("aad:signedin");i("AADSignedIn",n.usefdlsLog,"Type","Refresh","TimeStamp",Math.round(performance.now()).toString(),"Source",s?"SW":"Client");c=!0}}catch(w){}c||(sj_evt.fire("aad:tokenfailed"),n.isAADIframeSSOAfterOnload?sj_evt.bind("onPP",function(){return f(n,r)},!0):f(n,r));u()},e=function(){s||(s=!0,w())},w=function(){var n=sj_gx();n.open("GET","/orgid/idtoken/refresh?source=client",!0);n.withCredentials=!0;n.onreadystatechange=function(){n.readyState===4&&o(n.status,n.response,!1)};n.send()};if(n.enableSWTokenRefresh&&navigator&&navigator.serviceWorker&&navigator.serviceWorker.controller){i("SWRefreshAttempt",n.usefdlsLog);var b=function(){i("SWRefreshStatusTimeout",n.usefdlsLog);e()},k=setTimeout(b,n.swRefreshStatusTimeoutInMs),a=new MessageChannel;navigator.serviceWorker.controller.postMessage({type:"tokenrefreshstatus",url:window.location.href},[a.port2]);a.port1.onmessage=function(r){var u,f;r.data&&r.data.type==="tokenrefreshstatus"&&(clearTimeout(k),u=!1,r.data.istokenrefreshpending!==!0&&(f=r.data.jsonresponse,f!=null&&f.isAuthenticated?(u=!0,o(200,r.data.jsonresponse,!0)):e()),i("SWRefreshStatusResponse",n.usefdlsLog,"IsTokenRefreshPending","".concat(r.data.istokenrefreshpending),"IsAuthenticated","".concat(u),"ResponseTime","".concat(Date.now())))};var d=function(){i("SWRefreshTimeout",n.usefdlsLog);e()},g=setTimeout(d,n.swRefreshResponseTimeoutInMs),v=function(t){if(t.data&&t.data.type==="refreshresponse"){var r=t.data.jsonresponse;i("SWRefreshResponse",n.usefdlsLog,"Status","".concat(t.data.status),"IsAuthenticated","".concat(r&&r.isAuthenticated),"ResponseTime","".concat(Date.now()));clearTimeout(g);o(t.data.status,t.data.jsonresponse,!0);navigator.serviceWorker.removeEventListener("message",v)}};navigator.serviceWorker.addEventListener("message",v)}else e()}}var o="ssofr",t="OrgId",h="BAWTokens",c="OrgIdRefreshResponse",r=[],e;n.timerRef=null;n.isScheduled=!1;var u=function(){if(!(r.length<=0)){var n=r.join(",");r=[];(new Image).src=_G.lsUrl+"&Type=Event.ClientInst&DATA=["+n+"]"}},s=function(n,t){t?r.push('{"T":"CI.ClientInst","FID":"'+n+'","Name":"OrgId",'+t+"}"):r.push('{"T":"CI.ClientInst","FID":"'+n+'","Name":"OrgId"}')},i=function(n,t){for(var f,r,i=[],u=2;u<arguments.length;u++)i[u-2]=arguments[u];if(!t&&typeof Log!="undefined"&&Log&&Log.Log)Log.Log.apply(Log,__spreadArray(["ClientInst",n,"OrgId",!1],i,!1));else if(!i||i.length<=0||i.length%2!=0)s(n);else{for(f="",r=0;r<i.length;r=r+2)r!==0&&(f+=","),f+='"'+i[r]+'":"'+i[r+1]+'"';s(n,f)}};n.scheduleSingleSignIn=function(n,r){var h,e,o,s,c,l;if(n!=null){if(n.checkWorkHours&&(h=sj_cook.get("BFBUSR","BAWAS"),h==="1")){if(e=new Date,o=e.getDay(),o<n.workDaysBegin||o>n.workDaysEnd){i("AADSSOAttemptDisabled",n.usefdlsLog,"Reason","outsideworkdays","FromPoll","".concat(n.isCalledFromPoll));return}if(s=e.getHours(),s<n.workHoursBegin||s>n.workHoursEnd){i("AADSSOAttemptDisabled",n.usefdlsLog,"Reason","outsideworkhours","FromPoll","".concat(n.isCalledFromPoll));return}}i("AADSSOAttempt",n.usefdlsLog,"FromPoll","".concat(n.isCalledFromPoll));sj_evt&&sj_evt.fire&&sj_evt.fire("aad:ssoattempt");n.userDetection!==null&&n.userDetection&&(c=sb_gt(),l=Math.floor(c/1e3)*1e3,sj_cook.set("SRCHUSR","T",l.toString(),!0,"/"));n.useRefreshFlow?v(n,r):n.isAADIframeSSOAfterOnload?sj_evt.bind("onPP",function(){return f(n,r)},!0):f(n,r);u()}};e=!1;n.pollSingleSignIn=function(i,r){if(i.isAjax||e)return 0;if(typeof Worker!="undefined"){var u=new Worker("/orgid/idtoken/poll");u.onmessage=function(i){i!=null&&i.data!=null&&n.scheduleSingleSignIn(i.data,r)};u.postMessage(i);e=!0}return 0}})(SingleSignIn||(SingleSignIn={}))